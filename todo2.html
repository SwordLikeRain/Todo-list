<!DOCTYPE html>
<html>

<head>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .todo-list {
            max-width: 400px;
            margin: 0 auto;
        }

        .list-selector {
            display: flex;
            margin: 10px 0;
        }

        .list-selector select {
            flex: 1;
        }

        .list-selector input {
            flex: 1;
        }

        .delete-list {
            flex: 0.2;
            margin-left: 5px;
        }

        .new
        .task {
            display: flex;
            align-items: center;
            margin: 5px 0;
            position: relative;
        }

        .status {
            width: 100px;
        }

        .content {
            flex: 1;
            cursor: pointer;
            max-width: 250px;
            white-space: normal;
            word-wrap: break-word;
        }

        .delete {
            cursor: pointer;
            display: none;
            position: absolute;
            right: 0;
        }

        .task:hover .delete {
            display: inline;
        }

        .filter-count {
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <div class="todo-list">
        <input type="text" id="newTask" placeholder="Add a new task" onkeydown="addTask(event)">
        <span id="listName" ondblclick="editListName()"></span>
        <div>
            <div class="list-selector">
                <select id="listSelect" onchange="changeList(event)"></select>
                <button class="add-list" onclick="createNewList()">Add New List</button>
                <button class="delete-list" onclick="deleteCurrentList()">Delete</button>
            </div>
            <input type="radio" name="filter" value="all" checked onclick="filterTasks('all')"> All
            <input type="radio" name="filter" value="todo" onclick="filterTasks('todo')"> To Do
            <input type="radio" name="filter" value="inProgress" onclick="filterTasks('inProgress')"> In Progress
            <input type="radio" name="filter" value="done" onclick="filterTasks('done')"> Done
        </div>
        <div id="filterCounts" class="filter-count">
            Total: <span id="totalTasks">0</span>
            To Do: <span id="toDoCount">0</span>
            In Progress: <span id="inProgressCount">0</span>
            Done: <span id="doneCount">0</span>
        </div>
        <div id="tasks"></div>
    </div>

    <script>
        const lists = [
            {
                name: "Default List",
                tasks: []
            }
        ];

        let currentListIndex = 0;
        let filterStatus = "all";

        function createNewList() {
            const newListName = prompt("Enter the name for the new list:");

            if (newListName === null) {
                // User clicked Cancel or closed the prompt
                return;
            }

            if (newListName.trim() === "") {
                alert("Please enter a list name.");
                return;
            }

            const newList = {
                name: newListName,
                tasks: []
            };
            lists.push(newList);
            currentListIndex = lists.length - 1; // Set currentListIndex to the index of the new list
            renderLists();
        }

        function editListName() {
            const listName = document.getElementById("listName");
            listName.setAttribute("contenteditable", true);
            listName.focus();
            listName.addEventListener("blur", () => {
                listName.setAttribute("contenteditable", false);
                lists[currentListIndex].name = listName.innerHTML;
                renderLists();
            });
        }

        function changeList(event) {
            currentListIndex = parseInt(event.target.value);
            renderLists();
        }

        function deleteCurrentList() {
            if (lists.length > 1) {
                lists.splice(currentListIndex, 1);
                currentListIndex = lists.length - 1;
                renderLists();
            }
            else {
                alert("The last list cannot be deleted.")
            }
        }

        function addTask(event) {
            if (event.key === "Enter") {
                const taskText = document.getElementById("newTask").value;
                if (taskText.trim() === "") {
                    return;
                }
                const task = {
                    status: "todo",
                    content: taskText
                };
                lists[currentListIndex].tasks.push(task);
                document.getElementById("newTask").value = "";
                renderTasks();
            }
        }

        function editTask(index) {
            const contentDiv = document.getElementById(`content-${index}`);
            contentDiv.setAttribute("contenteditable", true);
            contentDiv.focus();
            contentDiv.addEventListener("blur", () => {
                contentDiv.setAttribute("contenteditable", false);
                const taskText = contentDiv.innerHTML;
                if (taskText.trim() === "") {
                    return;
                }
                lists[currentListIndex].tasks[index].content = taskText;
                renderTasks();
            });
        }

        function deleteTask(index) {
            lists[currentListIndex].tasks.splice(index, 1);
            renderTasks();
        }

        function filterTasks(status) {
            filterStatus = status;
            renderTasks();
        }

        function renderLists() {
            const listSelect = document.getElementById("listSelect");
            listSelect.innerHTML = "";
            for (let i = 0; i < lists.length; i++) {
                const option = document.createElement("option");
                option.value = i;
                option.text = lists[i].name;
                if (i === currentListIndex) {
                    option.setAttribute("selected", true);
                }
                listSelect.appendChild(option);
            }
            document.getElementById("listName").innerHTML = lists[currentListIndex].name;
            renderTasks();
        }

        function renderTasks() {
            let toDoCount = 0;
            let inProgressCount = 0;
            let doneCount = 0;

            const tasksDiv = document.getElementById("tasks");
            tasksDiv.innerHTML = "";

            const currentTaskList = lists[currentListIndex].tasks;

            for (let i = 0; i < currentTaskList.length; i++) {
                const task = currentTaskList[i];

                if (filterStatus === "all" || task.status === filterStatus) {
                    const taskDiv = document.createElement("div");
                    taskDiv.classList.add("task");

                    const statusDiv = document.createElement("div");
                    statusDiv.classList.add("status");
                    statusDiv.innerHTML = `
                        <select onchange="changeStatus(${i}, this)">
                        <option value="todo" ${task.status === "todo" ? "selected" : ""}>To Do</option>
                        <option value="inProgress" ${task.status === "inProgress" ? "selected" : ""}>In Progress</option>
                        <option value="done" ${task.status === "done" ? "selected" : ""}>Done</option>
                        </select>
                    `;

                    const contentDiv = document.createElement("div");
                    contentDiv.classList.add("content");
                    contentDiv.innerHTML = task.content;
                    contentDiv.id = `content-${i}`;
                    contentDiv.addEventListener("dblclick", () => editTask(i));

                    const deleteDiv = document.createElement("div");
                    deleteDiv.classList.add("delete");
                    deleteDiv.innerHTML = "❌";
                    deleteDiv.addEventListener("click", () => deleteTask(i));
                    deleteDiv.addEventListener("mouseenter", () => deleteDiv.style.display = "block");
                    deleteDiv.addEventListener("mouseleave", () => deleteDiv.style.display = "none");

                    taskDiv.appendChild(statusDiv);
                    taskDiv.appendChild(contentDiv);
                    taskDiv.appendChild(deleteDiv);
                    tasksDiv.appendChild(taskDiv);

                }
                if (task.status === "todo") {
                    toDoCount++;
                } else if (task.status === "inProgress") {
                    inProgressCount++;
                } else if (task.status === "done") {
                    doneCount++;
                }
            }

            const totalTasks = currentTaskList.length;
            document.getElementById("totalTasks").textContent = totalTasks;
            document.getElementById("toDoCount").textContent = toDoCount;
            document.getElementById("inProgressCount").textContent = inProgressCount;
            document.getElementById("doneCount").textContent = doneCount;
        }

        function changeStatus(index, select) {
            lists[currentListIndex].tasks[index].status = select.value;
            renderTasks();
        }

        
        renderLists();
    </script>
</body>

</html>